# Claude Code への指示

このファイルは、Claude Codeが新しいセッションで作業を開始する際に読むべき指示をまとめています。

---

## 作業開始前の必須タスク

新しいセッションで作業を開始する前に、以下のドキュメントを**必ず順番に読んでください**:

1. **README.md** - プロジェクト概要、機能、セットアップ手順
2. **CONTRIBUTING.md** - 開発ルール、コミット規約、テスト駆動開発
3. **docs/SPECIFICATION.md** - 詳細技術仕様、ゲームルール、アルゴリズム

これらのドキュメントを読むことで、以下の重要な知識が得られます：
- EXオーバーリミット発動条件（`remainingCost <= min(costA, costB)`）
- チーム共有コスト（A/B別管理ではない）
- 総耐久値計算（初期耐久を含む）
- コミット規約（1コミット1変更、Type: Subject形式）
- テストファースト開発

---

## 重要な開発ルール

### コミット

- **1つの論理的変更につき1コミット**
- コミットメッセージ形式: `Type: Subject`
  - Type: Add, Fix, Update, Remove, Refactor, Test, Docs, Chore
- **プッシュは手動**（ユーザーが行う、自動プッシュしない）

### テスト

- **テストファースト**: 実装前にテストを書く
- コミット前に必ず `pnpm test` を実行
- すべてのテストがパスすることを確認

### 実装

- 仕様（docs/SPECIFICATION.md）に厳密に従う
- 不明点があれば仕様を再確認
- 境界値に注意（`<=` vs `<` など）
- **不明点がある場合は必ずユーザーに確認を取る**（勝手に判断・推測で実装しない）

---

## よくある間違い

これらの間違いは**過去に修正済み**です。新しい実装では繰り返さないでください：

❌ **間違い**: A機とB機が別々のコストを持つ
✅ **正解**: チームで6000コストを共有（`remainingCost`は1つ）

❌ **間違い**: EX発動条件 `remainingCost < minCost`
✅ **正解**: `remainingCost <= minCost`（等号を含む）

❌ **間違い**: 総耐久 = リスポーン耐久の合計
✅ **正解**: 総耐久 = 初期耐久A + 初期耐久B + リスポーン耐久の合計

❌ **間違い**: 全16パターンを表示
✅ **正解**: 実際の撃墜数（敗北まで）のみ表示、重複排除

---

## 開発環境

### ローカル環境
```bash
pnpm install
pnpm dev
pnpm test
```

### Docker環境
```bash
docker compose up dev
docker compose exec dev pnpm install
docker compose exec dev pnpm test
```

---

## プロジェクト構造

```
src/
├── lib/
│   ├── types.ts          # 型定義
│   ├── calculator.ts     # パターン生成・コスト計算
│   └── evaluators.ts     # 評価関数・EX発動判定
├── data/
│   ├── healthData.ts     # コスト別耐久値データ
│   └── overCostHealthTable.ts  # コストオーバー残耐久テーブル
├── components/
│   ├── Calculator.tsx    # メイン（状態管理）
│   └── ...               # UIコンポーネント
├── pages/
│   └── index.astro       # トップページ
└── styles/
    └── global.css        # グローバルスタイル
```

---

## チェックリスト

新しいセッションで作業を開始する際、以下を確認してください：

- [ ] README.md を読んだ
- [ ] CONTRIBUTING.md を読んだ
- [ ] docs/SPECIFICATION.md を読んだ
- [ ] 現在の git status を確認した
- [ ] 変更前にテストが通ることを確認した（`pnpm test`）

変更を加えた後：

- [ ] テストを追加/更新した
- [ ] すべてのテストがパスすることを確認した
- [ ] コミットメッセージが規約に従っている
- [ ] 1コミット1変更になっている
- [ ] プッシュは行っていない（ユーザーが手動で行う）

---

## 質問時の対応

ユーザーから質問や指示があった場合：

1. **仕様を確認**: まず docs/SPECIFICATION.md で該当する仕様を確認
2. **実装を確認**: 必要に応じて src/ 内のファイルを読む
3. **テストを確認**: 既存のテストケースから意図を理解
4. **不明点の確認**: 要件や仕様が不明確な場合は、勝手に推測せず**必ずユーザーに確認**
5. **回答または実装**: 仕様に基づいて正確に回答・実装

---

## このファイルの目的

このCLAUDE.mdは、セッション間で知識を引き継ぐために作成されました。新しいセッションでも、このファイルを読むことで：

- プロジェクトの背景を理解
- 重要な仕様を把握
- 過去の間違いを回避
- 一貫した開発フローを維持

できます。
