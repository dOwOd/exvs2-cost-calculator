# EXVS2 Cost Calculator

機動戦士ガンダム EXVS2 XB のコスト計算ツールです。

---

## 必読ドキュメント

新しいセッションで作業を開始する前に、以下のドキュメントを**必ず順番に読んでください**:

1. **README.md** - プロジェクト概要、機能、セットアップ手順
2. **CONTRIBUTING.md** - 開発ルール、コミット規約、テスト駆動開発
3. **docs/SPECIFICATION.md** - 詳細技術仕様、ゲームルール、アルゴリズム

---

## ルールファイル

詳細な開発ルールは `.claude/rules/` ディレクトリに分割されています：

- **specifications.md** - ゲーム仕様・計算ロジック（EX発動条件、コスト管理など）
- **development.md** - 開発ルール（コミット規約、テストファーストなど）
- **ui-patterns.md** - UI実装パターン（色分け、フォントサイズなど）
- **common-mistakes.md** - よくある間違い（過去に修正済みの問題）

これらのルールは、対象ファイルの編集時に自動的に読み込まれます。

---

## スキル

- **commit** - コミット規約に従ったコミットを作成（`/commit` で呼び出し）

---

## 開発環境

### ローカル環境
```bash
pnpm install
pnpm dev
pnpm test
```

### Docker環境
```bash
docker compose up dev
docker compose exec dev pnpm install
docker compose exec dev pnpm test
```

---

## チェックリスト

変更を加えた後：

- [ ] テストを追加/更新した
- [ ] すべてのテストがパスすることを確認した（`pnpm test`）
- [ ] コミットメッセージが規約に従っている
- [ ] Pull Requestを作成した（ユーザーがマージを行う）

---

## このファイルの目的

このCLAUDE.mdは、セッション開始時の概要を提供します。詳細なルールは `.claude/rules/` に分割されており、必要に応じて自動的に読み込まれます。

---

## Claude Codeとの作業ルール

### 基本方針

#### 1. 必ず確認してから実行
- **勝手に判断しない**: 不明点や複数の選択肢がある場合は必ず質問する
- **変更前に確認**: ファイルの編集・削除、コミット、pushの前に意図を確認
- **段階的に進める**: 大きなタスクは小さなステップに分割して進める

#### 2. コミュニケーション
- **日本語で応答**: すべての説明・コメントは日本語
- **技術用語**: コード内の変数名・関数名は英語OK
- **簡潔に**: 不要な前置きや過度な謝罪は避ける

#### 3. コード品質
- **セキュリティ**: XSS、SQLインジェクション、コマンドインジェクションなどの脆弱性を防ぐ
- **過剰な実装を避ける**: 要求された機能のみを実装（過度な抽象化・汎用化は不要）
- **既存パターンに従う**: プロジェクト内の既存コードスタイルを踏襲

#### 4. ファイル操作
- **読んでから書く**: 既存ファイルを編集する場合は必ず先に`Read`ツールで内容を確認
- **編集優先**: 新規ファイル作成よりも既存ファイルの編集を優先
- **不要なファイルを作らない**: ドキュメント・README等は明示的に依頼された場合のみ作成

### Git操作

#### コミットメッセージ形式
```
<種類>: <概要>

- 詳細な変更内容（箇条書き）

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**種類:**
- `Add`: 新機能追加
- `Update`: 既存機能の更新
- `Fix`: バグ修正
- `Refactor`: リファクタリング
- `Docs`: ドキュメント更新
- `Test`: テスト追加・修正
- `CI`: CI/CD設定変更

**注意**: 詳細なコミット規約は `CONTRIBUTING.md` および `.claude/rules/development.md` を参照してください。

#### Git安全プロトコル
- **破壊的コマンド禁止**: `push --force`, `reset --hard`, `checkout .`は明示的な指示がない限り使用しない
- **フックをスキップしない**: `--no-verify`等は使用しない
- **特定ファイルのステージング**: `git add .`ではなく、ファイル名を指定してステージング

#### Pull Request ワークフロー

**基本方針**: すべての変更はPull Requestを通じて行います。

**ブランチ戦略:**
```bash
# 機能開発
feature/issue-番号-簡潔な説明

# バグ修正
fix/issue-番号-簡潔な説明

# ドキュメント
docs/簡潔な説明
```

**ワークフロー:**
1. mainブランチから機能ブランチを作成
2. 実装とテストを行う
3. コミットする（複数回OK）
4. Pull Requestを作成
5. レビュー後、ユーザーがマージ

**PR作成:**
- Claude Codeが実装完了後、自動的にPRを作成
- タイトル: コミットメッセージ形式に従う
- 本文: 変更内容、テスト方法を記載
- **プッシュとPR作成はClaude Codeが行う**（ユーザーの承認後）

### セッション引き継ぎ

#### セッション開始時
1. **このファイル（CLAUDE.md）を読む**
2. **必読ドキュメントを確認**: README.md、CONTRIBUTING.md、docs/SPECIFICATION.md
3. **ルールファイルを確認**: `.claude/rules/` ディレクトリ
4. **現在のタスクを確認**: ユーザーに現在の作業状況を質問

#### セッション終了時
1. **変更内容をコミット**: すべての変更をコミット（pushは**しない**）
2. **次のタスクを明記**: 次のセッションで何をすべきか記録

---

## このファイル（CLAUDE.md）の更新ルール

### 更新が必要なタイミング

セッション中に以下の変更があった場合、このファイルの更新を検討してください:

#### 1. 技術的な決定事項の変更
- **技術スタック**: 使用するライブラリ、フレームワーク、サービスの変更
- **アーキテクチャ**: システム構成、デプロイフロー、ブランチ戦略の変更
- **実装方針**: 設計パターン、コーディング規約の変更

**例:**
- Astroのバージョンアップで設定が変わった
- 新しいテストフレームワークの導入
- 状態管理の方法が変更された

#### 2. 新しいルールや制約の追加
- **開発ワークフロー**: 新しい手順、承認フローの追加
- **Git操作ルール**: ブランチ命名規則、コミットルールの追加
- **コーディング規約**: ESLint設定、フォーマットルールの追加
- **セキュリティ要件**: 新しいセキュリティチェック、脆弱性対策

**例:**
- PR作成前にlintチェックが必須になった
- コミットメッセージにチケット番号の記載が必要になった
- 特定のライブラリの使用が禁止になった

#### 3. トラブルと解決策の発見
- **実装中に遭遇した問題**: エラー、バグ、予期しない動作
- **解決方法**: 実際に効果があった対処法
- **回避策**: 根本解決ではないが暫定的に使える方法

**例:**
- ビルドエラーの解決策を発見した
- テスト実行時の特定の問題と対処法を見つけた
- ゲームロジックのエッジケースへの対応方法を確立した

#### 4. 環境変数・設定の追加（該当する場合）
- **新しい環境変数**: .env等の追加
- **設定ファイル**: astro.config.mjs、jest.config.js等の重要な変更
- **外部サービス連携**: 新しいAPIキー、トークンの追加

### 更新の手順

#### ステップ1: 更新の必要性を判断
セッション中に上記のいずれかに該当する変更があったか確認します。

#### ステップ2: ユーザーに確認
```
「以下の変更があったため、CLAUDE.mdの更新が必要と判断しました:
- [変更内容を簡潔に説明]
CLAUDE.mdを更新してもよろしいですか？」
```

#### ステップ3: 更新実施
ユーザーの承認後、該当セクションを更新します:
- **技術スタック** セクション
- **開発環境** セクション
- **Claude Codeとの作業ルール** セクション
- **チェックリスト** セクション

#### ステップ4: 更新履歴を記録
変更内容を簡潔に記録します。

### 更新しない場合

以下は一時的な情報のため、CLAUDE.mdには記録しません:
- 一時的なデバッグ情報
- 個人的なメモ
- 特定のPRやブランチに関する情報
- まだ確定していない仮の決定事項

これらは代わりに:
- PRコメントに記録
- 別のドキュメント（ISSUES.md、TODO.md等）に記録
- `.claude/rules/common-mistakes.md`に記録（よくある間違いの場合）

### 重要な原則

**常に確認してから更新**:
- 自動的に更新せず、必ずユーザーに確認
- 更新内容を明確に説明
- 不要な更新は避ける（CLAUDE.mdは長期的に有用な情報のみ）
