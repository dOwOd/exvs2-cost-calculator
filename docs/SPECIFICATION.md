# EXVS2 ã‚³ã‚¹ãƒˆè¨ˆç®—æ©Ÿ æŠ€è¡“ä»•æ§˜æ›¸

## æ¦‚è¦

æ©Ÿå‹•æˆ¦å£«ã‚¬ãƒ³ãƒ€ãƒ  EXTREME VS. 2 ã‚¤ãƒ³ãƒ•ã‚£ãƒ‹ãƒƒãƒˆãƒ–ãƒ¼ã‚¹ãƒˆã®2æ©Ÿç·¨æˆã«ãŠã‘ã‚‹æ’ƒå¢œé †ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è©•ä¾¡ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è©³ç´°ä»•æ§˜ã€‚

---

## 1. ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«

### 1.1 ãƒãƒ¼ãƒ æ§‹æˆ

- **2æ©Ÿç·¨æˆ**: æ©Ÿä½“Aã€æ©Ÿä½“Bï¼ˆåŒã˜ãƒãƒ¼ãƒ ï¼‰
- **åˆæœŸã‚³ã‚¹ãƒˆ**: 6000ï¼ˆãƒãƒ¼ãƒ å…±æœ‰ã€A/Båˆ¥ç®¡ç†ã§ã¯ãªã„ï¼‰
- **ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—**: 3000 / 2500 / 2000 / 1500
- **è€ä¹…å€¤**: ã‚³ã‚¹ãƒˆã”ã¨ã«è¤‡æ•°ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

### 1.2 æ’ƒå¢œã¨ã‚³ã‚¹ãƒˆ

- æ©Ÿä½“ãŒæ’ƒå¢œã•ã‚Œã‚‹ã¨ã€ãã®æ©Ÿä½“ã‚³ã‚¹ãƒˆåˆ†ã‚’ãƒãƒ¼ãƒ å…±æœ‰ã®æ®‹ã‚³ã‚¹ãƒˆã‹ã‚‰æ¸›ç®—
- **æ®‹ã‚³ã‚¹ãƒˆ > 0**: ãƒªã‚¹ãƒãƒ¼ãƒ³å¯èƒ½
- **æ®‹ã‚³ã‚¹ãƒˆ <= 0**: æ•—åŒ—ï¼ˆè©¦åˆçµ‚äº†ï¼‰

### 1.3 ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…å€¤

æ’ƒå¢œã•ã‚ŒãŸæ©Ÿä½“ãŒãƒªã‚¹ãƒãƒ¼ãƒ³ã™ã‚‹éš›ã®è€ä¹…å€¤ã¯ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã§æ±ºå®š:

- **æ®‹ã‚³ã‚¹ãƒˆ >= æ©Ÿä½“ã‚³ã‚¹ãƒˆ**: åˆæœŸè€ä¹…å€¤ã§å¾©æ´»
- **0 < æ®‹ã‚³ã‚¹ãƒˆ < æ©Ÿä½“ã‚³ã‚¹ãƒˆ**: ã‚³ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼çŠ¶æ…‹ã€ã‚²ãƒ¼ãƒ å†…å›ºå®šãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰è€ä¹…å€¤ã‚’æ±ºå®š
- **æ®‹ã‚³ã‚¹ãƒˆ <= 0**: å¾©æ´»ãªã—ï¼ˆæ•—åŒ—ï¼‰

**é‡è¦**: ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…å€¤ã¯è¨ˆç®—å¼ã§ã¯ãªãã€**ã‚²ãƒ¼ãƒ å†…å›ºå®šãƒ†ãƒ¼ãƒ–ãƒ«**ã‹ã‚‰å–å¾—ã™ã‚‹ã€‚

è©³ç´°ã¯ `src/data/overCostHealthTable.ts` ã‚’å‚ç…§ã€‚

---

## 2. EXã‚ªãƒ¼ãƒãƒ¼ãƒªãƒŸãƒƒãƒˆ

### 2.1 ç™ºå‹•æ¡ä»¶

```
æ®‹ã‚³ã‚¹ãƒˆ <= min(ã‚³ã‚¹ãƒˆA, ã‚³ã‚¹ãƒˆB)
```

**æ„å‘³**: ã€Œè‡ªæ©Ÿã¨åƒšæ©Ÿã®ã„ãšã‚Œã‚‚ãŒæ’ƒå¢œã•ã‚ŒãŸã‚‰æ•—åŒ—ã™ã‚‹çŠ¶æ³ã€

### 2.2 ç™ºå‹•å˜ä½

- **ãƒãƒ¼ãƒ å˜ä½**ã§ç™ºå‹•
- æ¡ä»¶ã‚’æº€ãŸã™ã¨ã€Aãƒ»Bä¸¡æ–¹ã®æ©Ÿä½“ãŒåŒæ™‚ã«ç™ºå‹•å¯èƒ½çŠ¶æ…‹ã¨ãªã‚‹
- 1è©¦åˆä¸­ã«æ¡ä»¶ã‚’æº€ãŸã™ã®ã¯1å›ã®ã¿ï¼ˆã€ŒEXã‚ªãƒ¼ãƒãƒ¼å›æ•°ã€ã¨ã„ã†æ¦‚å¿µã¯ãªã„ï¼‰

### 2.3 å…·ä½“ä¾‹

| ç·¨æˆ | æ’ƒå¢œé † | æ®‹ã‚³ã‚¹ãƒˆæ¨ç§» | EXç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|:-----|:-------|:-------------|:----------------|
| 3000+3000 | Aæ’ƒå¢œ | 6000 â†’ 3000 | âœ… 3000 <= 3000 |
| 3000+2500 | Aæ’ƒå¢œ | 6000 â†’ 3000 | âŒ 3000 > 2500 |
| 3000+2500 | Aâ†’Bæ’ƒå¢œ | 6000 â†’ 3000 â†’ 500 | âœ… 500 <= 2500 |
| 2500+2500 | Aâ†’Aæ’ƒå¢œ | 6000 â†’ 3500 â†’ 1000 | âœ… 1000 <= 2500 |
| 1500+1500 | Aâ†’Aâ†’Aæ’ƒå¢œ | 6000 â†’ 4500 â†’ 3000 â†’ 1500 | âœ… 1500 <= 1500 |

### 2.4 å®Ÿè£…ä¸Šã®æ³¨æ„

- **å¢ƒç•Œå€¤**: `<=` ã‚’ä½¿ç”¨ï¼ˆ`<` ã§ã¯ãªã„ï¼‰
- æ®‹ã‚³ã‚¹ãƒˆ == minCost ã®ã‚±ãƒ¼ã‚¹ã§ã‚‚EXç™ºå‹•ã™ã‚‹
- æ•—åŒ—ã—ãŸå¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ãƒã‚§ãƒƒã‚¯ä¸è¦ï¼ˆæ—¢ã«ç™ºå‹•æ¸ˆã¿ã‹ã€ç™ºå‹•ã›ãšã«æ•—åŒ—ï¼‰

---

## 2.5 å¾©æ´»ã‚ã‚Š

### 2.5.1 æ¦‚è¦

ä¸€éƒ¨ã®æ©Ÿä½“ã¯ã€Œå¾©æ´»ã‚ã‚Šã€èƒ½åŠ›ã‚’æŒã¤ã€‚é€šå¸¸ã§ã‚ã‚Œã°æ•—åŒ—ï¼ˆ`remainingCost <= 0`ï¼‰ã¨ãªã‚‹æ’ƒå¢œæ™‚ã«ã€è€ä¹…100ã§å¾©æ´»ã™ã‚‹ã€‚

### 2.5.2 ç™ºå‹•æ¡ä»¶

- `remainingCost <= 0`ï¼ˆé€šå¸¸ãªã‚‰æ•—åŒ—ï¼‰ã®æ’ƒå¢œæ™‚
- æ’ƒå¢œã•ã‚ŒãŸæ©Ÿä½“ãŒå¾©æ´»ã‚ã‚Šèƒ½åŠ›ã‚’æŒã¤
- ãã®æ©Ÿä½“ã®å¾©æ´»ãŒã¾ã ä½¿ã‚ã‚Œã¦ã„ãªã„ï¼ˆ1æ©Ÿä½“ã«ã¤ã1å›ã®ã¿ï¼‰

### 2.5.3 åŠ¹æœ

- è€ä¹…100ã§å¾©æ´»
- `remainingCost` ã¯ãã®ã¾ã¾ï¼ˆâ‰¤ 0 ã®ã¾ã¾ï¼‰
- æ¬¡ã®æ’ƒå¢œã¯å³æ•—åŒ—ï¼ˆç›¸æ–¹ã‚‚å¾©æ´»ã‚ã‚ŠæŒã¡ã§æœªä½¿ç”¨ã§ãªã‘ã‚Œã°ï¼‰

### 2.5.4 å¯¾è±¡æ©Ÿä½“

- ãƒªãƒœãƒ¼ãƒ³ã‚ºã‚¬ãƒ³ãƒ€ãƒ ï¼ˆ3000/640ï¼‰
- ã‚¬ãƒ³ãƒ€ãƒ ãƒ»ãƒãƒ«ãƒãƒˆã‚¹ãƒ«ãƒ—ã‚¹ãƒ¬ã‚¯ã‚¹ï¼ˆ3000/640ï¼‰
- ç™¾å¼ï¼ˆ2500/620ï¼‰
- ã‚¬ãƒ³ãƒ€ãƒ ãƒ»ã‚°ã‚·ã‚ªãƒ³ãƒªãƒ™ã‚¤ã‚¯ãƒ•ãƒ«ã‚·ãƒ†ã‚£ï¼ˆ2500/620ï¼‰
- ã‚¸ã‚ªãƒ³ã‚°ï¼ˆ2500/620ï¼‰
- ã‚¯ã‚·ãƒ£ãƒˆãƒªãƒ¤ï¼ˆ2000/600ï¼‰
- ãƒ“ãƒ«ãƒ‰ã‚¹ãƒˆãƒ©ã‚¤ã‚¯ã‚¬ãƒ³ãƒ€ãƒ ï¼ˆãƒ•ãƒ«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ï¼ˆ2000/600ï¼‰
- ã‚¶ã‚¯ã‚¢ãƒ¡ã‚¤ã‚¸ãƒ³ã‚°ï¼ˆ2000/600ï¼‰
- ã‚¬ãƒ³ãƒ€ãƒ ã‚¨ã‚¯ã‚·ã‚¢ï¼ˆ2000/600ï¼‰

### 2.5.5 è¨ˆç®—ã¸ã®å½±éŸ¿

**ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ**:
- å¾©æ´»ãƒ¦ãƒ‹ãƒƒãƒˆæ•°ã«å¿œã˜ã¦æœ€å¤§æ’ƒå¢œæ•°ã‚’å¢—ã‚„ã™
- åŸºæœ¬4 + å¾©æ´»ãƒ¦ãƒ‹ãƒƒãƒˆæ•°ï¼ˆæœ€å¤§6: åŸºæœ¬4 + å¾©æ´»2ï¼‰
- ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°: 2^maxKillsï¼ˆ16/32/64é€šã‚Šï¼‰

**ç·è€ä¹…å€¤**:
- å¾©æ´»è¡Œã¯ `isDefeat: false` ãªã®ã§ `respawnHealth`ï¼ˆ100ï¼‰ãŒè‡ªç„¶ã«åŠ ç®—ã•ã‚Œã‚‹

**æœ€çŸ­æ•—åŒ—æ™‚ã®è€ä¹…å€¤**:
- å¾©æ´»æŒã¡ãƒ¦ãƒ‹ãƒƒãƒˆã¯ +100 ã‚’åŠ ç®—
- `ceil(6000/cost) Ã— health + 100`

### 2.5.6 å…·ä½“ä¾‹

| ç·¨æˆ | æ’ƒå¢œé † | æ®‹ã‚³ã‚¹ãƒˆæ¨ç§» | å¾©æ´» |
|:-----|:-------|:-------------|:-----|
| 3000(å¾©æ´»)+3000 | Aâ†’Aâ†’A | 3000â†’0â†’-3000 | 2å›ç›®ã§Aå¾©æ´»(è€ä¹…100)ã€3å›ç›®ã§æ•—åŒ— |
| 2500(å¾©æ´»)+2500(å¾©æ´») | Aâ†’Bâ†’Aâ†’Bâ†’A | 3500â†’1000â†’-1500â†’-4000â†’-6500 | 3å›ç›®ã§Aå¾©æ´»ã€4å›ç›®ã§Bå¾©æ´»ã€5å›ç›®ã§æ•—åŒ— |

---

## 3. ã‚³ã‚¹ãƒˆè¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### 3.1 ã‚³ã‚¹ãƒˆæ¨ç§»è¨ˆç®—

```typescript
function calculateCostTransitions(
  pattern: UnitId[],
  formation: Formation
): BattleState[]
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:

1. åˆæœŸã‚³ã‚¹ãƒˆ6000ã‹ã‚‰é–‹å§‹
2. ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæ’ƒå¢œé †ï¼‰ã‚’é †ç•ªã«å‡¦ç†:
   - æ’ƒå¢œã•ã‚ŒãŸæ©Ÿä½“ã®ã‚³ã‚¹ãƒˆã‚’æ®‹ã‚³ã‚¹ãƒˆã‹ã‚‰æ¸›ç®—
   - æ®‹ã‚³ã‚¹ãƒˆ <= 0 ãªã‚‰æ•—åŒ— â†’ å‡¦ç†çµ‚äº†
   - æ®‹ã‚³ã‚¹ãƒˆ > 0 ãªã‚‰ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…å€¤ã‚’å–å¾—
3. å„ã‚¹ãƒ†ãƒƒãƒ—ã®çŠ¶æ…‹ã‚’`BattleState`ã¨ã—ã¦è¨˜éŒ²

**BattleState**:

```typescript
interface BattleState {
  killCount: number;          // ç´¯è¨ˆæ’ƒå¢œæ•°
  killedUnit: UnitId;         // æ’ƒå¢œã•ã‚ŒãŸæ©Ÿä½“ï¼ˆ'A' | 'B'ï¼‰
  remainingCost: number;      // ãƒãƒ¼ãƒ å…±æœ‰ã®æ®‹ã‚³ã‚¹ãƒˆ
  isOverCost: boolean;        // ã‚³ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼çŠ¶æ…‹ã‹
  respawnHealth: number;      // ãƒªã‚¹ãƒãƒ¼ãƒ³æ™‚ã®è€ä¹…å€¤
  isDefeat: boolean;          // æ•—åŒ—ã—ãŸã‹
}
```

### 3.2 ç·è€ä¹…å€¤è¨ˆç®—

```typescript
function calculateTotalHealth(
  formation: Formation,
  transitions: BattleState[]
): number
```

**è¨ˆç®—å¼**:

```
ç·è€ä¹… = åˆæœŸè€ä¹…A + åˆæœŸè€ä¹…B + Î£(ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…)
```

**é‡è¦**: åˆæœŸè€ä¹…å€¤ã‚’å«ã‚ã‚‹ï¼ˆãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…ã®ã¿ã§ã¯ãªã„ï¼‰

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:

1. `total = formation.unitA.health + formation.unitB.health` ã§åˆæœŸåŒ–
2. å„ transition ã«ã¤ã„ã¦:
   - `isDefeat = true` ãªã‚‰åŠ ç®—ã—ãªã„ï¼ˆå¾©æ´»ã—ãªã„ãŸã‚ï¼‰
   - `isDefeat = false` ãªã‚‰ `respawnHealth` ã‚’åŠ ç®—
3. åˆè¨ˆã‚’è¿”ã™

### 3.3 æœ€çŸ­ã§ã®æ•—åŒ—æ™‚ã®è€ä¹…å€¤è¨ˆç®—

```typescript
function calculateMinimumDefeatHealth(formation: Formation): number
```

**è¨ˆç®—å¼**:

ç‰‡æ–¹ã®æ©Ÿä½“ã ã‘ãŒç‹™ã‚ã‚Œç¶šã‘ãŸå ´åˆã®æœ€å°ãƒ€ãƒ¡ãƒ¼ã‚¸ã€‚

```
Aã ã‘ç‹™ã‚ã‚Œã‚‹: ceil(6000 / costA) Ã— healthA
Bã ã‘ç‹™ã‚ã‚Œã‚‹: ceil(6000 / costB) Ã— healthB
æœ€çŸ­ã§ã®æ•—åŒ—æ™‚ã®è€ä¹…å€¤ = min(Aã ã‘, Bã ã‘)
```

**ä¾‹**:

3000(750) + 2500(680) ã®å ´åˆ:
- Aã ã‘: `ceil(6000/3000) Ã— 750 = 2 Ã— 750 = 1500`
- Bã ã‘: `ceil(6000/2500) Ã— 680 = 3 Ã— 680 = 2040`
- **æœ€çŸ­**: `min(1500, 2040) = 1500`

**ç”¨é€”**:

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œæ•µãŒæœ€ã‚‚åŠ¹ç‡çš„ã«æ”»ã‚ã¦ããŸå ´åˆã®è€ä¹…å€¤ã€ã‚’ç¤ºã™
- ç·è€ä¹…å€¤ã¨ä½µã›ã¦è¡¨ç¤ºï¼ˆä¾‹: `ç·è€ä¹… 2440 (æœ€çŸ­: 1500)`ï¼‰

---

## 4. ã‚½ãƒ¼ãƒˆã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### 4.1 ã‚½ãƒ¼ãƒˆ

å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’**ç·è€ä¹…é™é †**ã§ã‚½ãƒ¼ãƒˆã€‚

- **æŒ‡æ¨™**: `totalHealth`ï¼ˆé™é †ï¼‰
- **ç†ç”±**: ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…å¤‰å‹•ã‚’è€ƒæ…®ã—ãŸçœŸã®ç·è€ä¹…å€¤ãŒæœ€ã‚‚é‡è¦ãªæŒ‡æ¨™

### 4.2 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿æ©Ÿèƒ½ã€‚

#### EXã‚ªãƒ¼ãƒãƒ¼ãƒªãƒŸãƒƒãƒˆç™ºå‹•å¯èƒ½ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

- `isEXActivationFailure = false` ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿è¡¨ç¤º
- ãƒã‚§ãƒƒã‚¯æ™‚ï¼šEXç™ºå‹•ã§ããªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é™¤å¤–
- ãƒã‚§ãƒƒã‚¯è§£é™¤æ™‚ï¼šå…¨ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤º

**å®Ÿè£…:**
```typescript
const filteredPatterns = showOnlyEXAvailable
  ? sortedPatterns.filter((p) => !p.isEXActivationFailure)
  : sortedPatterns;
```

---

## 5. ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆã¨é‡è¤‡æ’é™¤

### 5.1 ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ

å…¨16é€šã‚Šã®æ’ƒå¢œé †ã‚’ç”Ÿæˆ:

```
['A', 'A', 'A', 'A']
['A', 'A', 'A', 'B']
['A', 'A', 'B', 'A']
...
['B', 'B', 'B', 'B']
```

### 5.2 å®Ÿéš›ã®æ’ƒå¢œé †

ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯4å›åˆ†ã®æ’ƒå¢œã‚’æƒ³å®šã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã«ã¯æ•—åŒ—æ™‚ç‚¹ã§çµ‚äº†ã™ã‚‹ã€‚

**ä¾‹**: 3000+3000ç·¨æˆã§`['A', 'A', 'A', 'A']`ã‚’è©•ä¾¡
- 1å›ç›®: Aæ’ƒå¢œï¼ˆæ®‹3000ï¼‰
- 2å›ç›®: Aæ’ƒå¢œï¼ˆæ®‹0ã€æ•—åŒ—ï¼‰
- **å®Ÿéš›ã®æ’ƒå¢œé †**: `['A', 'A']`ï¼ˆ2å›ã®ã¿ï¼‰

### 5.3 é‡è¤‡æ’é™¤

ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤ºæ™‚ã€**å®Ÿéš›ã®æ’ƒå¢œé †**ãŒåŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯é‡è¤‡ã¨ã—ã¦é™¤å¤–ã€‚

**å®Ÿè£…**:

```typescript
const actualPattern = pattern.transitions.map((t) => t.killedUnit).join('');
if (!seen.has(actualPattern)) {
  seen.add(actualPattern);
  unique.push(pattern);
}
```

**ä¾‹**:
- `['A', 'A', 'A', 'A']` â†’ å®Ÿéš›: `"AA"` â†’ æ¡ç”¨
- `['A', 'A', 'B', 'B']` â†’ å®Ÿéš›: `"AA"` â†’ é‡è¤‡ï¼ˆé™¤å¤–ï¼‰

---

## 6. ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 6.1 å‹å®šç¾©ï¼ˆsrc/lib/types.tsï¼‰

```typescript
/** ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ— */
export type CostType = 1500 | 2000 | 2500 | 3000;

/** æ©Ÿä½“ID */
export type UnitId = 'A' | 'B';

/** æ©Ÿä½“è¨­å®šï¼ˆã‚³ã‚¹ãƒˆ + è€ä¹…ã®çµ„ã¿åˆã‚ã›ï¼‰ */
export type UnitConfig = {
  cost: CostType;
  health: number;
}

/** ç·¨æˆï¼ˆ2æ©Ÿï¼‰ */
export type Formation = {
  unitA: UnitConfig;
  unitB: UnitConfig;
}

/** æˆ¦é—˜çŠ¶æ…‹ï¼ˆå„æ’ƒå¢œã‚¹ãƒ†ãƒƒãƒ—ï¼‰ */
export type BattleState = {
  killCount: number;
  killedUnit: UnitId;
  remainingCost: number;      // ãƒãƒ¼ãƒ å…±æœ‰
  isOverCost: boolean;
  respawnHealth: number;
  isDefeat: boolean;
}

/** è©•ä¾¡æ¸ˆã¿ãƒ‘ã‚¿ãƒ¼ãƒ³ */
export type EvaluatedPattern = {
  pattern: UnitId[];              // æƒ³å®šæ’ƒå¢œé †ï¼ˆ4å›åˆ†ï¼‰
  totalHealth: number;
  overCostCount: number;
  canActivateEXOverLimit: boolean;
  isEXActivationFailure: boolean;
  transitions: BattleState[];     // å®Ÿéš›ã®æ’ƒå¢œå±¥æ­´
}
```

### 6.2 ã‚³ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼è€ä¹…ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆsrc/data/overCostHealthTable.tsï¼‰

```typescript
export const overCostHealthTable: OverCostHealthTable = {
  3000: {
    800: { 500: 140, 1000: 270, 1500: 400, 2000: 540, 2500: 670 },
    760: { 500: 130, 1000: 260, 1500: 380, 2000: 510, 2500: 640 },
    // ... ä»–ã®è€ä¹…å€¤
  },
  2500: {
    700: { 500: 140, 1000: 280, 1500: 420, 2000: 560 },
    // ... ä»–ã®è€ä¹…å€¤
  },
  // ... ä»–ã®ã‚³ã‚¹ãƒˆ
};

export function getRespawnHealth(
  cost: CostType,
  initialHealth: number,
  remainingCost: number
): number {
  if (remainingCost <= 0) return 0;
  if (remainingCost >= cost) return initialHealth;
  return overCostHealthTable[cost][initialHealth][remainingCost];
}
```

---

## 7. UIä»•æ§˜

### 7.1 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

- **2ã‚«ãƒ©ãƒ **: å·¦400pxï¼ˆç·¨æˆé¸æŠï¼‰ã€å³å¯å¤‰ï¼ˆçµæœè¡¨ç¤ºï¼‰
- **ãƒ†ãƒ¼ãƒ**: ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼ˆbg-slate-900ï¼‰

### 7.2 ç·¨æˆé¸æŠ

1. **ã‚³ã‚¹ãƒˆé¸æŠ**: ãƒœã‚¿ãƒ³ï¼ˆ1500 / 2000 / 2500 / 3000ï¼‰
2. **è€ä¹…å€¤é¸æŠ**: ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼ˆãã®ã‚³ã‚¹ãƒˆã§åˆ©ç”¨å¯èƒ½ãªè€ä¹…å€¤ä¸€è¦§ï¼‰

### 7.3 çµæœè¡¨ç¤º

#### ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½

- **ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹**: ã€ŒEXã‚ªãƒ¼ãƒãƒ¼ãƒªãƒŸãƒƒãƒˆç™ºå‹•å¯èƒ½ã®ã¿è¡¨ç¤ºã€
- ãƒã‚§ãƒƒã‚¯æ™‚: `isEXActivationFailure = false` ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿è¡¨ç¤º
- ãƒã‚§ãƒƒã‚¯è§£é™¤æ™‚: å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤º

#### ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚«ãƒ¼ãƒ‰

**å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤º**: ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤ºï¼ˆç·è€ä¹…é™é †ã€é‡è¤‡æ’é™¤å¾Œï¼‰

**ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†:**
- ãƒ©ãƒ³ã‚¯ç•ªå·ï¼ˆtext-3xl / 30pxï¼‰
- æ’ƒå¢œé †ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆtext-2xl / 24pxï¼‰
- EXç™ºå‹•å¯å¦ãƒãƒƒã‚¸: âœ… EXã‚ªãƒ¼ãƒãƒ¼ãƒªãƒŸãƒƒãƒˆç™ºå‹•å¯ï¼ˆç·‘ï¼‰ / âš ï¸ EXä¸ç™ºï¼ˆèµ¤ï¼‰

**è©•ä¾¡æŒ‡æ¨™:**
- ç·è€ä¹…ãƒ©ãƒ™ãƒ«ï¼ˆtext-base / 16pxï¼‰
- ç·è€ä¹…å€¤ï¼ˆtext-3xl / 30pxï¼‰
- æœ€çŸ­ã§ã®æ•—åŒ—æ™‚ã®è€ä¹…å€¤ï¼ˆtext-base / 16pxï¼‰- è¨ˆç®—å¼: `min(ceil(6000/costA) Ã— healthA, ceil(6000/costB) Ã— healthB)`

**ã‚³ã‚¹ãƒˆæ¨ç§»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆtext-lg / 18pxï¼‰:**

| åˆ— | å†…å®¹ |
|:---|:-----|
| æ’ƒå¢œé † | è©¦åˆå…¨ä½“ã§ã®æ’ƒå¢œã®é †ç•ªï¼ˆ1, 2, 3...ï¼‰ |
| å¯¾è±¡ | æ’ƒå¢œã•ã‚ŒãŸæ©Ÿä½“ï¼ˆA/Bï¼‰ |
| ãƒãƒ¼ãƒ æ®‹ã‚³ã‚¹ãƒˆ | æ•°å€¤ + **ã‚³ã‚¹ãƒˆãƒãƒ¼**ï¼ˆè¦–è¦šçš„è¡¨ç¾ï¼‰ |
| ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹… | ãƒªã‚¹ãƒãƒ¼ãƒ³æ™‚ã®è€ä¹…å€¤ã€‚ã‚³ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼æ™‚ã¯ãƒ•ãƒ«è€ä¹…ã‹ã‚‰ã®æ¸›å°‘é‡ãƒ»æ¸›å°‘å‰²åˆã‚’ä½µè¨˜ï¼ˆä¾‹: `140 (-660 / -82%)`ï¼‰ |
| çŠ¶æ…‹ | âœ“ é€šå¸¸ / âš ï¸ ã‚³ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ / ğŸ’€ æ•—åŒ— |

#### ã‚³ã‚¹ãƒˆãƒãƒ¼ã®ä»•æ§˜

**è¡¨ç¤º:**
- æ¨ªé•·ãƒãƒ¼ï¼ˆé«˜ã•12pxã€rounded-fullï¼‰
- å¹… = `(æ®‹ã‚³ã‚¹ãƒˆ / 6000) Ã— 100%`

**è‰²åˆ†ã‘ï¼ˆå„ªå…ˆåº¦é †ï¼‰:**
1. ğŸ”´ **EXç™ºå‹•å¯èƒ½**ï¼ˆæ®‹ã‚³ã‚¹ãƒˆâ‰¤minCost ã‹ã¤ >0ï¼‰: èµ¤ï¼ˆbg-red-500ï¼‰
   - è‡ªæ©Ÿã¨åƒšæ©Ÿã®ã©ã¡ã‚‰ãŒæ’ƒå¢œã•ã‚Œã¦ã‚‚æ•—åŒ—ã™ã‚‹æœ€ã‚‚ãƒ”ãƒ³ãƒãªçŠ¶æ…‹
2. ğŸŸ  **æ®‹ã‚³ã‚¹ãƒˆ3000ä»¥ä¸‹**ï¼ˆæ®‹ã‚³ã‚¹ãƒˆâ‰¤3000 ã‹ã¤ >0ï¼‰: ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆbg-orange-500ï¼‰
   - ã‚³ã‚¹ãƒˆãŒåŠåˆ†ä»¥ä¸‹ã«ãªã£ãŸæ³¨æ„çŠ¶æ…‹
3. ğŸŸ¡ **ã‚³ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼**ï¼ˆisOverCost = trueï¼‰: é»„ï¼ˆbg-yellow-500ï¼‰
   - ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…å€¤ãŒä½ä¸‹ã—ã¦ã„ã‚‹çŠ¶æ…‹
4. ğŸ”µ **é€šå¸¸**: é’ï¼ˆbg-blue-500ï¼‰
   - æ­£å¸¸ãªçŠ¶æ…‹

**æ³¨è¨˜:**
- æ•—åŒ—æ™‚ï¼ˆæ®‹ã‚³ã‚¹ãƒˆâ‰¤0ï¼‰ã¯ã‚³ã‚¹ãƒˆãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€è‰²åˆ†ã‘ã«å«ã¾ãªã„

**ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:**
- `transition-all` ã§æ»‘ã‚‰ã‹ã«å¤‰åŒ–

---

## 8. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 8.1 ãƒ†ã‚¹ãƒˆå¯¾è±¡

- `getRespawnHealth`: ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…å€¤å–å¾—
- `calculateCostTransitions`: ã‚³ã‚¹ãƒˆæ¨ç§»è¨ˆç®—
- `calculateTotalHealth`: ç·è€ä¹…å€¤è¨ˆç®—
- `checkEXActivation`: EXç™ºå‹•åˆ¤å®š

### 8.2 é‡è¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### getRespawnHealth

- æ®‹ã‚³ã‚¹ãƒˆ >= æ©Ÿä½“ã‚³ã‚¹ãƒˆ â†’ åˆæœŸè€ä¹…
- æ®‹ã‚³ã‚¹ãƒˆ <= 0 â†’ 0
- ã‚³ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ â†’ ãƒ†ãƒ¼ãƒ–ãƒ«å€¤

#### calculateCostTransitions

- å„ç·¨æˆã§ã®æ’ƒå¢œæ•°ï¼ˆ2å›ã€3å›ã€4å›ï¼‰
- æ®‹ã‚³ã‚¹ãƒˆã®æ­£ç¢ºæ€§
- æ•—åŒ—åˆ¤å®š

#### calculateTotalHealth

- åˆæœŸè€ä¹…ã‚’å«ã‚€ã‹
- ãƒªã‚¹ãƒãƒ¼ãƒ³è€ä¹…ã®åˆè¨ˆãŒæ­£ã—ã„ã‹

#### checkEXActivation

- å¢ƒç•Œå€¤ï¼ˆæ®‹ã‚³ã‚¹ãƒˆ == minCostï¼‰
- å„ç·¨æˆã§ã®ç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ç™ºå‹•å‰æ•—åŒ—ã®ã‚±ãƒ¼ã‚¹

---

## 9. æ—¢çŸ¥ã®åˆ¶ç´„ãƒ»v1.0ã‚¹ã‚³ãƒ¼ãƒ—å¤–

- âŒ ãƒãƒ¼ã‚¹ãƒˆæ©Ÿèƒ½
- âŒ ã‚³ã‚¹ãƒˆæ¨ç§»ã‚°ãƒ©ãƒ•ï¼ˆæ•°å€¤ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿ï¼‰
- âŒ ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ
- âŒ æ©Ÿä½“åç®¡ç†ï¼ˆã‚³ã‚¹ãƒˆ+è€ä¹…ã®çµ„ã¿åˆã‚ã›ã®ã¿ï¼‰

---

## 10. å‚è€ƒè³‡æ–™

- [EXVS2 å…¬å¼ã‚µã‚¤ãƒˆ](https://gs.bandainamco-ol.co.jp/exvs2/)
- [EXVS2XBæ”»ç•¥wiki - ã‚³ã‚¹ãƒˆã®ã‚»ã‚ªãƒªãƒ¼](https://wikiwiki.jp/exvs2xb/%E3%82%B3%E3%82%B9%E3%83%88%E3%81%AE%E3%82%BB%E3%82%AA%E3%83%AA%E3%83%BC)
