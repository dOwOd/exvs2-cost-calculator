# ゲーム仕様・計算ロジック

このルールは `src/lib/**/*.ts` の編集時に適用されます。

## EXオーバーリミット発動条件

**重要**: 発動条件は `remainingCost <= min(costA, costB)` です。

- `<` ではなく `<=` を使用（等号を含む）
- minCost は A機とB機のコストの小さい方
- 例: A=2500, B=3000 の場合、残コスト ≤ 2500 で発動

## EXオーバーリミットの効果

| 効果     | 詳細                                                                  |
| -------- | --------------------------------------------------------------------- |
| 発動時間 | 10秒間                                                                |
| 攻撃力   | 上昇                                                                  |
| 機動力   | 上昇                                                                  |
| バリア   | 敵の攻撃を100ダメージ分防ぐ                                           |
| 耐久回復 | 発動中に与えたダメージの30%を自身の耐久値として回復（上限: フル耐久） |

### 発動タイミングの注意

- 僚機が撃墜されてから復活するまで**約3秒**かかる
- その間はEXオーバーリミットが発動しない
- 両機が瀕死の状態で片方が撃墜されると、残りの機体も3秒以内に撃墜されてEX発動前に負ける危険性がある

## チーム共有コスト管理

**重要**: A機とB機は別々のコストを持ちません。

- チーム全体で6000コストを共有
- `remainingCost` は1つのみ（A用・B用に分かれない）
- 撃墜されるたびに `remainingCost -= 撃墜された機体のコスト`

## 総耐久値計算

**正しい計算式**:

```
総耐久値 = 初期耐久A + 初期耐久B + リスポーン耐久の合計
```

- 初期耐久を含むことに注意
- リスポーン耐久のみの合計ではない

## 最短敗北時の耐久値

```typescript
min(
  ceil(6000 / costA) × healthA,
  ceil(6000 / costB) × healthB
)
```

- どちらか一方の機体だけが撃墜され続けた場合の最短耐久値

## パターン生成

- 全16パターンではなく、実際の撃墜数（敗北まで）のみ生成
- 重複パターンは排除
- 敗北条件: `remainingCost < costA && remainingCost < costB`
