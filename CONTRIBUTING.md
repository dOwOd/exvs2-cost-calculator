# 開発ルール

このプロジェクトの開発における規約とベストプラクティスをまとめています。

## コミット規約

### コミットメッセージフォーマット

```
<Type>: <Subject>

<Body>
```

#### Type（必須）

- `Add`: 新機能・新ファイルの追加
- `Fix`: バグ修正
- `Update`: 既存機能の変更・改善
- `Remove`: ファイル・機能の削除
- `Refactor`: リファクタリング
- `Test`: テストの追加・修正
- `Docs`: ドキュメントの追加・修正
- `Chore`: ビルド・設定ファイルの変更

#### Subject（必須）

- 変更内容を簡潔に記述（50文字以内推奨）
- 英語または日本語
- 文末にピリオド不要

#### Body（任意）

- 変更の詳細な説明
- なぜその変更が必要だったか
- 複数行可

#### 例

```
Fix: EX発動判定の条件を <= に修正

残コスト == minCost のケースでもEXが発動するべきだったが、
< 演算子を使用していたため境界値で発動しなかった。
テストケースを追加して修正を確認。
```

### コミット単位

- **1つの論理的変更につき1コミット**
- 複数の変更を混在させない
- テストとコードは同じコミットに含めてよい
- 不要な変更（フォーマットのみの変更など）は含めない

### プッシュ

- **プッシュは手動で行う**（自動プッシュしない）
- コミット後、`git push`は実行せずユーザーに確認を任せる

---

## テスト駆動開発（TDD）

### 基本原則

1. **テストファースト**: 実装前にテストを書く
2. **テストの実行確認**: テストが正しく動作することを確認
3. **実装**: テストをパスするコードを書く
4. **リファクタリング**: テストが通ったままコードを改善

### テストの書き方

- テストファイルは `*.test.ts` 形式
- `describe`ブロックで機能をグループ化
- `test`/`it`で個別のテストケースを記述
- テスト名は日本語で具体的に（例: `'3000+3000: 1回撃墜後にEX発動'`）

### テストの実行

```bash
# ローカル環境
pnpm test

# Docker環境
docker compose exec dev pnpm test

# ウォッチモード（ファイル変更時に自動実行）
pnpm test:watch

# カバレッジ計測
pnpm test:coverage
```

### テストの必須チェック項目

- [ ] 新しいロジックには必ずテストを追加
- [ ] すべてのテストがパスすることを確認
- [ ] エッジケース・境界値をテスト
- [ ] コミット前に`pnpm test`を実行

---

## コードレビュー基準

### 必須確認項目

- [ ] 仕様に準拠しているか（SPECIFICATION.md参照）
- [ ] テストがパスしているか
- [ ] コミットメッセージが規約に従っているか
- [ ] 1コミット1変更になっているか
- [ ] 不要なコード・コメントが含まれていないか

### 推奨事項

- 変数名・関数名は意図が明確か
- コメントは最小限か（コードで説明できることはコメント不要）
- パフォーマンスに問題はないか

---

## 開発フロー

### ローカル開発

```bash
# 依存関係のインストール
pnpm install

# 開発サーバー起動
pnpm dev

# テスト実行
pnpm test

# ビルド
pnpm build
```

### Docker開発

```bash
# コンテナ起動
docker compose up dev

# シェルに入る
docker compose exec dev sh

# コンテナ内でコマンド実行
docker compose exec dev pnpm install
docker compose exec dev pnpm test

# コンテナ停止
docker compose down
```

---

## トラブルシューティング

### テストが失敗する

1. `pnpm install`で依存関係を再インストール
2. キャッシュをクリア: `pnpm test --clearCache`
3. エラーメッセージを読んで該当ファイルを確認

### Dockerでアクセスできない

- `pnpm dev`に`--host`フラグが付いているか確認
- ポート4321が他のプロセスで使用されていないか確認

---

## 参考リンク

- [仕様書](./docs/SPECIFICATION.md)
- [README](./README.md)
