---
import { ThemeToggle } from './ThemeToggle';
import { ENABLE_CONTACT } from '../lib/contactConfig';

const base = import.meta.env.BASE_URL;

const navItems = [
  { href: base, label: 'コスト計算' },
  { href: `${base}guide/`, label: 'ガイド' },
  { href: `${base}faq/`, label: 'FAQ' },
  ...(ENABLE_CONTACT ? [{ href: `${base}contact/`, label: 'お問い合わせ' }] : []),
];

const currentPath = Astro.url.pathname;

const isCurrentPage = (href: string) => {
  if (href === base) {
    return currentPath === base;
  }
  return currentPath.startsWith(href);
};
---

<a
  href="#main"
  class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:bg-white focus:text-blue-600 focus:px-4 focus:py-2 focus:rounded focus:shadow-lg dark:focus:bg-gray-800 dark:focus:text-blue-400"
>
  メインコンテンツへスキップ
</a>
<header class="border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800">
  <div class="container mx-auto px-3 sm:px-4 md:px-6">
    <div class="flex items-center justify-between h-14">
      <div class="flex items-center gap-2 sm:gap-6">
        <a
          href={base}
          class="text-lg font-bold text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors whitespace-nowrap shrink-0"
        >
          <span class="sm:hidden">EXVS2</span>
          <span class="hidden sm:inline">EXVS2 コスト計算機</span>
        </a>

        <!-- デスクトップナビ -->
        <nav aria-label="メインナビゲーション" class="hidden sm:block">
          <ul class="flex items-center gap-1">
            {
              navItems.map((item) => {
                const current = isCurrentPage(item.href);
                return (
                  <li>
                    <a
                      href={item.href}
                      aria-current={current ? 'page' : undefined}
                      class:list={[
                        'px-3 py-1.5 rounded-md text-sm font-medium transition-colors whitespace-nowrap',
                        current
                          ? 'bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300'
                          : 'text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-700',
                      ]}
                    >
                      {item.label}
                    </a>
                  </li>
                );
              })
            }
          </ul>
        </nav>
      </div>

      <div class="flex items-center gap-1">
        <ThemeToggle client:load />
        <!-- ハンバーガーボタン（スマホのみ） -->
        <button
          id="mobile-menu-btn"
          type="button"
          class="sm:hidden p-1.5 rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
          aria-expanded="false"
          aria-controls="mobile-menu"
          aria-label="メニューを開く"
        >
          <svg
            id="menu-icon-open"
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <svg
            id="menu-icon-close"
            class="w-6 h-6 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- モバイルメニュー -->
    <nav
      id="mobile-menu"
      class="hidden sm:hidden border-t border-slate-200 dark:border-slate-700"
      aria-label="モバイルナビゲーション"
    >
      <ul class="flex flex-col py-2">
        {
          navItems.map((item) => {
            const current = isCurrentPage(item.href);
            return (
              <li>
                <a
                  href={item.href}
                  aria-current={current ? 'page' : undefined}
                  class:list={[
                    'block px-3 py-2.5 rounded-md text-sm font-medium transition-colors',
                    current
                      ? 'bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300'
                      : 'text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-700',
                  ]}
                >
                  {item.label}
                </a>
              </li>
            );
          })
        }
      </ul>
    </nav>
  </div>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  btn?.addEventListener('click', () => {
    const isHidden = menu?.classList.toggle('hidden');
    btn.setAttribute('aria-expanded', String(!isHidden));
    btn.setAttribute('aria-label', isHidden ? 'メニューを開く' : 'メニューを閉じる');
    iconOpen?.classList.toggle('hidden');
    iconClose?.classList.toggle('hidden');
  });
</script>
